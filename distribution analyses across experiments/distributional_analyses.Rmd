---
title: "Distributional Analyses"
author: "Jamie Cummins & Ian Hussey"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide
    highlight: haddock
    theme: flatly
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

```{r include=FALSE}

knitr::opts_chunk$set(message = FALSE, 
                      warning = FALSE, 
                      echo = FALSE)

```

```{r}

library(tidyverse)
library(patchwork)

exp_1_df <- read_csv("../experiment 1/data/processed/processed_data.csv") %>%
  filter(self_exclusion_1 == "Yes, use my data" & complete_data == TRUE) %>%
  dplyr::mutate(experiment = "exp_1",
                age = as.character(age))

exp_2_df <- read_csv("../experiment 2/data/processed/processed_data.csv") %>%
  filter(self_exclusion_1 == "Yes, use my data" & complete_data == TRUE) %>%
  dplyr::mutate(experiment = "exp_2",
                age = as.character(age))

exp_3_df <- read_csv("../experiment 3/data/processed/processed_data.csv") %>%
  filter(self_exclusion_1 == "Yes, use my data" & complete_data == TRUE) %>%
  dplyr::mutate(experiment = "exp_3",
                age = as.character(age))

exp_4_df <- read_csv("../experiment 4/data/processed/processed_data.csv") %>%
  filter(self_exclusion_1 == "Yes, use my data" & complete_data == TRUE) %>%
  dplyr::mutate(experiment = "exp_4",
                age = as.character(age))

exp_5_df <- read_csv("../experiment 5/data/processed/processed_data.csv") %>%
  filter(self_exclusion_1 == "Yes, use my data" & complete_data == TRUE) %>%
  dplyr::mutate(experiment = "exp_5",
                age = as.character(age))

combined_exps_2_and_5 <- bind_rows(exp_2_df, exp_5_df)

combined_all_exps <- bind_rows(exp_1_df, exp_2_df, exp_3_df, exp_4_df, exp_5_df)

```

# Density plots

## Experiment 1 

Distribution of IA-AMP effect in Experiment 1 appears somewhat bimodal. Shape is descriptively similar to that of Mann et al.'s findings.

```{r}

ggplot(exp_1_df, aes(IA_AMP_effect_positive_negative)) +
  geom_density(adjust = .5) +
  labs(x = "IA-AMP effect", title = "Density plot: Experiment 1") +
  theme_classic()

```

## Experiment 2 

Distribution of both AMP effects in Experiment 2 appear bimodal.

```{r}
a <- ggplot(exp_2_df, aes(AMP_effect_positive_negative)) +
  geom_density(adjust = .5) +
  labs(x = "Standard AMP effect", title = "Density plots: Experiment 2") +
  theme_classic()

b <- ggplot(exp_2_df, aes(IA_AMP_effect_positive_negative)) +
  geom_density(adjust = .5) +
  labs(x = "IA-AMP effect") +
  theme_classic()

library(patchwork)
a + b
```

## Experiment 3 

Distribution of both AMP effects in Experiment 3 appear bimodal.

```{r}
c <- ggplot(exp_3_df, aes(AMP_effect_obama_trump)) +
  geom_density(adjust = .5) +
  labs(x = "Standard Trump-Obama AMP effect", title = "Density plots: Experiment 3") +
  theme_classic()

d <- ggplot(exp_3_df, aes(IA_AMP_effect_positive_negative)) +
  geom_density(adjust = .5) +
  labs(x = "IA-AMP positive/negative effect") +
  theme_classic()

library(patchwork)
c + d
```

## Experiment 4 

Distribution of the positive/negative AMP effect in Experiment 4 appears bimodal.

Distribution of the Trump/Obama is trimodal.

```{r}
e <- ggplot(exp_4_df, aes(IA_AMP_effect_positive_negative)) +
  geom_density(adjust = .5) +
  labs(x = "IA-AMP positive/negative effect", title = "Density plots: Experiment 4") +
  theme_classic()

f <- ggplot(exp_4_df, aes(IA_AMP_effect_obama_trump)) +
  geom_density(adjust = .5) +
  labs(x = "IA-AMP Trump-Obama effect") +
  theme_classic()

library(patchwork)
e + f
```

## Experiment 4: make Trump/Obama IA-AMP absolute

Making scores in the Trump/Obama IA-AMP shows more evidence of bimodality.

```{r}
ggplot(exp_4_df, aes(abs(IA_AMP_effect_obama_trump))) +
  geom_density(adjust = .5) +
  labs(x = "IA-AMP Trump-Obama effect", title = "Density plots: Experiment 4") +
  theme_classic()

```

## Experiment 5

Using the Mann et al. AMPs might descriptively reduce bimodality somewhat, but it does not eliminate it completely.

```{r}

g <- ggplot(exp_5_df, aes(IA_AMP_effect_positive_negative)) +
  geom_density(adjust = .5) +
  labs(x = "IA-AMP effect", title = "Density plots: Experiment 5") +
  theme_classic()

h <- ggplot(exp_5_df, aes(AMP_effect_positive_negative)) +
  geom_density(adjust = .5) +
  labs(x = "AMP effect") +
  theme_classic()

g + h

```

## Combined all exps

```{r}

combined_all_exps %>%
  dplyr::count()

ggplot(combined_all_exps, aes(AMP_effect_positive_negative)) +
  geom_density(adjust = 1) +
  labs(x = "AMP effect", title = "Density plots: All exps") +
  theme_classic()

ggplot(combined_all_exps, aes(IA_AMP_effect_positive_negative)) +
  geom_density(adjust = 1) +
  labs(x = "IA_AMP effect", title = "Density plots: All exps") +
  theme_classic()

combined_all_exps %>%
  dplyr::select(IA_AMP_effect_positive_negative, AMP_effect_positive_negative) %>%
  gather(AMP, AMP_effect, c(IA_AMP_effect_positive_negative, AMP_effect_positive_negative)) %>%
  ggplot(aes(AMP_effect, fill = AMP)) +
  geom_density(adjust = 1, alpha = 0.6) +
  labs(x = "AMP effect") +
  theme_classic() +
  scale_fill_viridis_d(begin = 0.1, end = 0.7)

```

# Comparing distributions between Exp 2 and Exp 5 

## AMP

```{r}

ggplot(combined_exps_2_and_5, aes(AMP_effect_positive_negative, fill = experiment)) +
  geom_density(adjust = 1, alpha = 0.6) +
  labs(x = "AMP effect") +
  theme_classic() +
  scale_fill_viridis_d(begin = 0.1, end = 0.7)

ks.test(exp_2_df$AMP_effect_positive_negative, exp_5_df$AMP_effect_positive_negative)

```

## IA AMP

# Other comparisons between exp 2 and 5 (regular vs Mann AMPs)

## Differences in AMP effect distribution between regular vs Mann AMPs:

```{r}

ggplot(combined_exps_2_and_5, aes(IA_AMP_effect_positive_negative, fill = experiment)) +
  geom_density(adjust = 1, alpha = 0.6) +
  labs(x = "IA-AMP effect") +
  theme_classic() +
  scale_fill_viridis_d(begin = 0.1, end = 0.7)

ks.test(exp_2_df$IA_AMP_effect_positive_negative, exp_5_df$IA_AMP_effect_positive_negative)

```

## Differences in influence rates between regular and Mann AMPs:

```{r}

library(broom)

joined_temp <- exp_2_df %>%
  rbind(exp_5_df) 

t.test(influence_rate ~ experiment,
                   data = joined_temp) %>%
  tidy()

```

## Differences in moderation of the AMP effect between regular and Mann AMPs:

```{r}

library(sjPlot)

temp_fit <- lm(IA_AMP_effect_positive_negative ~ influence_rate * experiment,
               data = joined_temp)
tab_model(temp_fit, show.std = TRUE)
plot_model(temp_fit, type = "int")

```

## IA AMP effect predicts AMP effect

```{r}

cor.test(joined_temp$IA_AMP_effect_positive_negative, joined_temp$AMP_effect_positive_negative)

temp_fit <- lm(AMP_effect_positive_negative ~ IA_AMP_effect_positive_negative * experiment,
               data = joined_temp)
tab_model(temp_fit, show.std = TRUE)
plot_model(temp_fit, type = "int")

```