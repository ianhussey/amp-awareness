---
title: "Structural validity analysis"
subtitle: "Associations between ratings of prime types between influence aware vs. non influence aware trials"
author: "Ian Hussey"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide
    highlight: haddock
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r include=FALSE}

knitr::opts_chunk$set(message = FALSE, 
                      warning = FALSE)

```

```{r setup, message=FALSE, warning=FALSE}

# dependencies
library(tidyverse)
library(broom)
library(timesavers)  # for round_df()
library(knitr)
library(kableExtra)
library(lme4)
library(sjPlot)
library(effects)

# get data
data_ratings <- 
  read.csv("../meta analysis/data/data_combined_trial_level.csv")  %>%
  mutate(influenced = as.logical(influenced)) %>%
  dplyr::group_by(experiment, IA_AMP_domain, unique_id, influenced, prime_type) %>%
  dplyr::summarize(mean_rating = mean(rating, na.rm = TRUE)) %>%
  ungroup() %>%
  dplyr::mutate(influenced = dplyr::recode(as.numeric(influenced),
                                           "0" = "Unaware",
                                           "1" = "Aware")) %>%
  spread(prime_type, mean_rating) %>%
  rename(rating_prime_type_B = Negative,
         rating_prime_type_A = Positive,
         domain = IA_AMP_domain) 
  

```

# Structural validity of AMP effects between influence aware vs unaware trials

The scored AMP effect is the proportion of trials on which the rating is congruent with the valence of the prime. This method of scoring is intuitive: it leverages the asssumption that the positive and negative primes exert opposite influence on the ratings; the more negatively participants rate on negative prime trials, the more positively they should rate on positive prime trials.

This core feature of the scoring method therefore also provides a testable assumption of its structural validity: ratings on positive prime trials should be negatively correlated with ratings on negative prime trials. Importantly, this can be compared between the influence aware and non influence aware trials. 

If responses on the AMP function as a valid measure of atttiudes, the association between the ratings of the two categories must be negative.

Following Payne 2013, the non-influence aware trials can be defined as relatively "implicit" whereas the influence aware trials can be defined as relatively explicit. 

Putting these two premises together, for the AMP to be a structurally valid implicit measure (i.e., both implicit and a valid measure), the association between ratings of the two trial types should be negative for the non infuence aware trials.

These analyses test this.

```{r fig.height=5, fig.width=6.5}

# fit model
fit <- lmer(rating_prime_type_B ~ rating_prime_type_A * influenced + (1 | experiment) + (1 | domain), 
            data = data_ratings)

# plot
plot_model(fit, type = "int") +
  xlab("Evaluation of targets\npreceeded by prime type A") +
  ylab("Evaluation of targets\npreceeded by prime type B") +
  theme_classic() + 
  labs(colour = "Trials") +
  scale_color_viridis_d(begin = 0.3, end = 0.7) +
  scale_fill_viridis_d(begin = 0.3, end = 0.7) +
  ggtitle("") +
  xlim(0,1) +
  ylim(0,1)

# ggplot(data_ratings, aes(prime_type_A, prime_type_B, color = influenced)) +
#   geom_smooth(method = "lm", fullrange = TRUE) +
#   facet_wrap(~interaction(experiment, domain))

# table
tab_model(fit, 
          show.std = TRUE, 
          emph.p = FALSE, 
          digits.p = 52)

```


The desired negative correlations of ratings between the two prime type are only found for influence aware trials.

The relatively implicit (non influence aware) trials were found to have positive associations.  

Results suggest that the implicit trials are not a valid measure, whereas the valid trials are not implicit.

